

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Storm's Blog</title>
    
    
    <meta name="author" content="TutorChen">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.1.1/css/font-awesome.css" rel="stylesheet">
    <link href="/css/typo.css" rel="stylesheet">
    <link href="/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/css/solarized.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/datatables-bootstrap.css" rel="stylesheet">
    <link href="/css/codepiano.css" rel="stylesheet">

    <!-- javascript files -->
    <script type="text/javascript" src="/js/jquery-2.0.0.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="/js/datatables-bootstrap.js"></script>
    <script type="text/javascript" src="/js/codepiano.js"></script>

    <!-- Le fav and touch icons -->
    <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    <script type="text/javascript">
    </script>

  </head>

  <body id="scroll-pane" data-spy="scroll" data-target="#time-list-nav">
    <div class="wrapper">
      <!-- 导航条 -->
      <div class="navbar">
        <div class="navbar-inner row-fluid">
          <div class="span2">
          </div>
          <div class="span8">
            <a class="brand" href="/">
              <span class="site-author"> TutorChen </span>
              <span class="site-title"> /* 夢想開啟新的未來 */ </span>
            </a>
            <ul class="nav">
              
              
              





<li class="posts"><a href="/posts.html">文章</a></li>
<li class="timeline"><a href="/timeline.html">归档</a></li>
<li class="categories"><a href="/categories.html">目录</a></li>
<li class="about"><a href="/about.html">关于</a></li>

            </ul>
          </div>
          <div class="span2">
          </div>
        </div>
      </div>

      <!-- 正文 -->
      

<div class="row-fluid typo">
  <div class="span2">
    <ul class="nav nav-tabs nav-stacked dispear" id="support">
      <li><a href="#" onclick="toggleSupport();return false;"><i class="icon-star-empty"></i> 技术支持</a></li>
      <li><a data-toggle="tooltip" title data-original-title="为 Twitter Bootstrap 设计的图标字体" href="http://fontawesome.io" target="_blank"><i class="icon-ok"></i> Font-Awesome</a></li>
      <li><a data-toggle="tooltip" title data-original-title="github提供的免费静态页面服务，使用git进行发布和管理" href="http://pages.github.com" target="_blank"><i class="icon-ok"></i> Github Pages</a></li>
      <li><a data-toggle="tooltip" title data-original-title="静态页面生成工具" href="http://jekyllrb.com" target="_blank"><i class="icon-ok"></i> Jekyll</a></li>
      <li><a data-toggle="tooltip" title data-original-title="博客页面模板" href="http://jekyllbootstrap.com" target="_blank"><i class="icon-ok"></i> Jekyll-Bootstrap</a></li>
      <li><a data-toggle="tooltip" title data-original-title="Javascript框架" href="http://jquery.com" target="_blank"><i class="icon-ok"></i> JQuery</a></li>
      <li><a data-toggle="tooltip" title data-original-title="基于JQuery的表格插件" href="http://www.datatables.net/" target="_blank"><i class="icon-ok"></i> DataTables</a></li>
      <li><a data-toggle="tooltip" title data-original-title="Twitter提供的前端框架" href="http://twitter.github.io/bootstrap" target="_blank"><i class="icon-ok"></i> Twitter Bootstrap</a></li>
      <li><a data-toggle="tooltip" title data-original-title="排版样式表" href="http://typo.sofish.de" target="_blank"><i class="icon-ok"></i> Typo.css</a></li>
      <li><a data-toggle="tooltip" title data-original-title="开发工具" href="http://www.vim.org" target="_blank"><i class="icon-ok"></i> Vim</a></li>
    </ul>
  </div>
  <div class="span8">
    

<!-- 按照分页插入博客文章 -->

  <h2 class="title"><a href="/android/2014/05/10/android-volley">Android 如何使用Volley</a></h2>
  <div class="post_info">
  
  <ul class="tag_box inline">
    <li><i class="icon-calendar"></i></li>
    <li id="post-date"> 2014 年 05 月 10 日</li>
    <li><i class="icon-folder-open"></i></li>
    
    
 
  <li>
    <a href="/categories.html#android-ref">
      android 
    </a>
  </li>
  



  </ul>
    
  <span>
  <div class="archive">
    
<p>在这次食物上传功能的开发中，其中WebView中上传图片需要调用系统的文件系统，默认WebView是不支持文件上传的，需要自己手动配置一些东西，具体代码如下：</p>

<div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BrowserActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">WebView</span> <span class="n">mWebView</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">ValueCallback</span><span class="o">&lt;</span><span class="n">Uri</span><span class="o">&gt;</span> <span class="n">mUploadMessage</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">FILECHOOSER_RESULTCODE</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">outState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">outState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_browser</span><span class="o">);</span>
        <span class="n">mWebView</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">webview</span><span class="o">);</span>
        <span class="n">mWebView</span><span class="o">.</span><span class="na">getSettings</span><span class="o">().</span><span class="na">setJavaScriptEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">mWebView</span><span class="o">.</span><span class="na">setWebChromeClient</span><span class="o">(</span><span class="k">new</span> <span class="n">MyWebClient</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onActivityResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="kt">int</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">requestCode</span> <span class="o">==</span> <span class="n">FILECHOOSER_RESULTCODE</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">mUploadMessage</span><span class="o">)</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="n">Uri</span> <span class="n">result</span> <span class="o">=</span> <span class="n">intent</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">resultCode</span> <span class="o">!=</span> <span class="n">RESULT_OK</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">intent</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
        <span class="n">mUploadMessage</span><span class="o">.</span><span class="na">onReceiveValue</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="n">mUploadMessage</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyWebClient</span> <span class="kd">extends</span> <span class="n">WebChromeClient</span> <span class="o">{</span>
        <span class="c1">// For Android 3.0-</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">openFileChooser</span><span class="o">(</span><span class="n">ValueCallback</span><span class="o">&lt;</span><span class="n">Uri</span><span class="o">&gt;</span> <span class="n">uploadMsg</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mUploadMessage</span> <span class="o">=</span> <span class="n">uploadMsg</span><span class="o">;</span>
            <span class="n">Intent</span> <span class="n">i</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_GET_CONTENT</span><span class="o">);</span>
            <span class="n">i</span><span class="o">.</span><span class="na">addCategory</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">CATEGORY_OPENABLE</span><span class="o">);</span>
            <span class="n">i</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="s">&quot;image/*&quot;</span><span class="o">);</span>
            <span class="n">startActivityForResult</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">createChooser</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="s">&quot;File Chooser&quot;</span><span class="o">),</span> <span class="n">FILECHOOSER_RESULTCODE</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// For Android 3.0+</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">openFileChooser</span><span class="o">(</span><span class="n">ValueCallback</span><span class="o">&lt;</span><span class="n">Uri</span><span class="o">&gt;</span> <span class="n">uploadMsg</span><span class="o">,</span> <span class="n">String</span> <span class="n">acceptType</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mUploadMessage</span> <span class="o">=</span> <span class="n">uploadMsg</span><span class="o">;</span>
            <span class="n">Intent</span> <span class="n">i</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_GET_CONTENT</span><span class="o">);</span>
            <span class="n">i</span><span class="o">.</span><span class="na">addCategory</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">CATEGORY_OPENABLE</span><span class="o">);</span>
            <span class="n">i</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="s">&quot;*/*&quot;</span><span class="o">);</span>
            <span class="n">startActivityForResult</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">createChooser</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="s">&quot;File Browser&quot;</span><span class="o">),</span> <span class="n">FILECHOOSER_RESULTCODE</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// For Android 4.1</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">openFileChooser</span><span class="o">(</span><span class="n">ValueCallback</span><span class="o">&lt;</span><span class="n">Uri</span><span class="o">&gt;</span> <span class="n">uploadMsg</span><span class="o">,</span> <span class="n">String</span> <span class="n">acceptType</span><span class="o">,</span> <span class="n">String</span> <span class="n">capture</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mUploadMessage</span> <span class="o">=</span> <span class="n">uploadMsg</span><span class="o">;</span>
            <span class="n">Intent</span> <span class="n">i</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_GET_CONTENT</span><span class="o">);</span>
            <span class="n">i</span><span class="o">.</span><span class="na">addCategory</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">CATEGORY_OPENABLE</span><span class="o">);</span>
            <span class="n">i</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="s">&quot;image/*&quot;</span><span class="o">);</span>
            <span class="n">startActivityForResult</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">createChooser</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="s">&quot;File Chooser&quot;</span><span class="o">),</span> <span class="n">FILECHOOSER_RESULTCODE</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>主要就是自定义了WebChromeClient，然而测试时发现在4.4以上的Android版本依然不可以，搜了下openFileChooser方法在4.4以后不是public的，所以以后不建议这种直接在WebView上传文件的做法。</p>

<p>stackoverflow参考链接：<a href="http://stackoverflow.com/questions/19882331/html-file-input-in-android-webview-android-4-4-kitkat">HTML file input in android webview (android 4.4, kitkat)</a></p>

  </div>
  <hr />
  

  <!-- 分页页码展示 -->
  <div id="post-pagination" class="pagination pagination-centered">
    <ul>
      <!-- 上一页按钮 -->
      
      <li class="disabled">
      <span><i class="icon-chevron-left"></i></span>
      </li>
      

      <!-- 第一页,访问根目录 -->
      
      <li class="active">
      <a href="#">1</a>
      </li>
      

      

      
      <li class="disabled">
      <a href="#"><i class="icon-chevron-right"></i></a>
      </li>
      
    </ul>
  </div>

  </div>
  <div class="span2">
  </div>
</div>


      
    

  </body>
</html>

